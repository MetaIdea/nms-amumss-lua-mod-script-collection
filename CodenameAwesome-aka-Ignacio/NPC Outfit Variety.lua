BAN_NON_PLAYERCHARACTER_REF_PATHS = true --removes parts that dont animate properly

SETTINGS = {
	{
		["SCENE"] = "MODELS/COMMON/PLAYER/PLAYERCHARACTER/NPCGEK.SCENE.MBIN",
		["ENTITY"] = "MODELS/COMMON/PLAYER/PLAYERCHARACTER/NPCGEK/ENTITIES/NPCGEKDATA.ENTITY.MBIN",
		["ATTACHMENTS"] = {
			"NPCGekData",
			"NPCLights",
		},
		["PREFERRED_PARTS"] = {
			{
				["TYPE"] = "_CHEST_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_CHEST_GEK"
				}
			},
			{
				["TYPE"] = "_GLOVES_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_GLOVES_GEK"
				}
			},
			{
				["TYPE"] = "_LEGS_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_LEGS_GEK"
				}
			},
			{
				["TYPE"] = "_BOOTS_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_BOOTS_GEK"
				}
			},
			{
				["TYPE"] = "_TORSO_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_TORSO_GEK"
				}
			},
			{
				["TYPE"] = "_CAPE_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_CAPE_NULL",
					"_CAPE_ATLAS",
					
				}
			},
		},
		["PART_BLACKLISTS"] = {
			{
				["TYPE"] = "_TORSO_",
				["IDs"] = {
					"_TORSO_BUILDERS",
				}
			},
			{
				["TYPE"] = "_LEGS_",
				["IDs"] = {
					"_LEGS_BUILDERS",
				}
			},
		},
		["PART_WHITELISTS"] = {
			{
				["TYPE"] = "_HEAD_",
				["IDs"] = {
					"_HEAD_GEK"
				}
			},
			{
				["TYPE"] = "_ASTRONECK_",
				["IDs"] = {
					"_ASTRONECK_XG",
				}
			},
			{
				["TYPE"] = "_FOURTHNECK_",
				["IDs"] = {
					"_FOURTHNECK_XG",
				}
			},
			{
				["TYPE"] = "_GEKNECK_",
				["IDs"] = {
					"_GEKNECK_XG",
				}
			},
			{
				["TYPE"] = "_ROBOT1NECK_",
				["IDs"] = {
					"_ROBOT1NECK_XG",
				}
			},
			{
				["TYPE"] = "_VANILLANECK_",
				["IDs"] = {
					"_VANILLANECK_XG",
				}
			},
			{
				["TYPE"] = "_VYKNECK_",
				["IDs"] = {
					"_VYKNECK_XG",
				}
			},
			{
				["TYPE"] = "_BACKPACK_",
				["IDs"] = {}
			},
			--[[{
				["TYPE"] = "_CAPE_",
				["IDs"] = {}
			},]]
		}
	},
	{
		["SCENE"] = "MODELS/COMMON/PLAYER/PLAYERCHARACTER/NPCKORVAX.SCENE.MBIN",
		["ENTITY"] = "MODELS/COMMON/PLAYER/PLAYERCHARACTER/NPCKORVAX/ENTITIES/NPCKORVAXDATA.ENTITY.MBIN",
		["ATTACHMENTS"] = {
			"NPCKorvaxData",
			"NPCLights",
		},
		["PREFERRED_PARTS"] = {
			{
				["TYPE"] = "_CHEST_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_CHEST_VANILLA"
				}
			},
			{
				["TYPE"] = "_GLOVES_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_GLOVES_VANILLA"
				}
			},
			{
				["TYPE"] = "_LEGS_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_LEGS_VANILLA"
				}
			},
			{
				["TYPE"] = "_BOOTS_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_BOOTS_VANILLA"
				}
			},
			{
				["TYPE"] = "_TORSO_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_TORSO_VANILLA"
				}
			},
			{
				["TYPE"] = "_CAPE_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_CAPE_NULL",
					"_CAPE_ATLAS",
					
				}
			},
		},
		["PART_BLACKLISTS"] = {
			{
				["TYPE"] = "_TORSO_",
				["IDs"] = {
					"_TORSO_BUILDERS",
				}
			},
			{
				["TYPE"] = "_LEGS_",
				["IDs"] = {
					"_LEGS_BUILDERS",
				}
			},
		},
		["PART_WHITELISTS"] = {
			{
				["TYPE"] = "_HEAD_",
				["IDs"] = {
					"_HEAD_KORVAX"
				}
			},
			{
				["TYPE"] = "_ASTRONECK_",
				["IDs"] = {
					"_ASTRONECK_XK",
				}
			},
			{
				["TYPE"] = "_FOURTHNECK_",
				["IDs"] = {
					"_FOURTHNECK_XK",
				}
			},
			{
				["TYPE"] = "_GEKNECK_",
				["IDs"] = {
					"_GEKNECK_XK",
				}
			},
			{
				["TYPE"] = "_ROBOT1NECK_",
				["IDs"] = {
					"_ROBOT1NECK_XK",
				}
			},
			{
				["TYPE"] = "_VANILLANECK_",
				["IDs"] = {
					"_VANILLANECK_XK",
				}
			},
			{
				["TYPE"] = "_VYKNECK_",
				["IDs"] = {
					"_VYKNECK_XK",
				}
			},
			{
				["TYPE"] = "_BACKPACK_",
				["IDs"] = {}
			},
			--[[{
				["TYPE"] = "_CAPE_",
				["IDs"] = {}
			},]]
		}
	},
	{
		["SCENE"] = "MODELS/COMMON/PLAYER/PLAYERCHARACTER/NPCVYKEEN.SCENE.MBIN",
		["ENTITY"] = "MODELS/COMMON/PLAYER/PLAYERCHARACTER/NPCVYKEEN/ENTITIES/NPCVYKEENDATA.ENTITY.MBIN",
		["ATTACHMENTS"] = {
			"NPCVykeenData",
			"NPCLights",
		},
		["PREFERRED_PARTS"] = {
			{
				["TYPE"] = "_CHEST_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_CHEST_VYKEEN"
				}
			},
			{
				["TYPE"] = "_GLOVES_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_GLOVES_VYKEEN"
				}
			},
			{
				["TYPE"] = "_LEGS_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_LEGS_VYKEEN"
				}
			},
			{
				["TYPE"] = "_BOOTS_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_BOOTS_VYKEEN"
				}
			},
			{
				["TYPE"] = "_TORSO_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_TORSO_VYKEEN"
				}
			},
			{
				["TYPE"] = "_CAPE_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_CAPE_NULL",
					"_CAPE_ATLAS",
					
				}
			},
		},
		["PART_BLACKLISTS"] = {
			{
				["TYPE"] = "_TORSO_",
				["IDs"] = {
					"_TORSO_BUILDERS",
				}
			},
			{
				["TYPE"] = "_LEGS_",
				["IDs"] = {
					"_LEGS_BUILDERS",
				}
			},
		},
		["PART_WHITELISTS"] = {
			{
				["TYPE"] = "_HEAD_",
				["IDs"] = {
					"_HEAD_WARRIOR"
				}
			},
			{
				["TYPE"] = "_ASTRONECK_",
				["IDs"] = {
					"_ASTRONECK_XV",
				}
			},
			{
				["TYPE"] = "_FOURTHNECK_",
				["IDs"] = {
					"_FOURTHNECK_XV",
				}
			},
			{
				["TYPE"] = "_GEKNECK_",
				["IDs"] = {
					"_GEKNECK_XV",
				}
			},
			{
				["TYPE"] = "_ROBOT1NECK_",
				["IDs"] = {
					"_ROBOT1NECK_XV",
				}
			},
			{
				["TYPE"] = "_VANILLANECK_",
				["IDs"] = {
					"_VANILLANECK_XV",
				}
			},
			{
				["TYPE"] = "_VYKNECK_",
				["IDs"] = {
					"_VYKNECK_XV",
				}
			},
			{
				["TYPE"] = "_BACKPACK_",
				["IDs"] = {}
			},
			--[[{
				["TYPE"] = "_CAPE_",
				["IDs"] = {}
			},]]
		}
	},
	{
		["SCENE"] = "MODELS/COMMON/PLAYER/PLAYERCHARACTER/NPCFOURTH.SCENE.MBIN",
		["ENTITY"] = "MODELS/COMMON/PLAYER/PLAYERCHARACTER/NPCFOURTH/ENTITIES/NPCFOURTHDATA.ENTITY.MBIN",
		["ATTACHMENTS"] = {
			"NPCFourthData",
			"NPCLights",
		},
		["PREFERRED_PARTS"] = {
			{
				["TYPE"] = "_HEAD_",
				["EXTRA_WEIGHT"] = 5,
				["IDs"] = {
					"_HEAD_FOURTH",
				}
			},
			{
				["TYPE"] = "_CHEST_",
				["EXTRA_WEIGHT"] = 10,
				["IDs"] = {
					"_CHEST_FOURTH",
					"_CHEST_ASTRO",
				}
			},
			{
				["TYPE"] = "_GLOVES_",
				["EXTRA_WEIGHT"] = 10,
				["IDs"] = {
					"_GLOVES_FOURTH",
					"_GLOVES_ASTRO",
				}
			},
			{
				["TYPE"] = "_LEGS_",
				["EXTRA_WEIGHT"] = 10,
				["IDs"] = {
					"_LEGS_FOURTH",
					"_LEGS_ASTRO",
				}
			},
			{
				["TYPE"] = "_BOOTS_",
				["EXTRA_WEIGHT"] = 10,
				["IDs"] = {
					"_BOOTS_FOURTH",
					"_BOOTS_ASTRO",
				}
			},
			{
				["TYPE"] = "_TORSO_",
				["EXTRA_WEIGHT"] = 10,
				["IDs"] = {
					"_TORSO_FOURTH",
					"_TORSO_ASTRO",
				}
			},
			{
				["TYPE"] = "_CAPE_",
				["EXTRA_WEIGHT"] = 20,
				["IDs"] = {
					"_CAPE_NULL",
					"_CAPE_ATLAS",
					
				}
			},
		},
		["PART_BLACKLISTS"] = {
			{
				["TYPE"] = "_TORSO_",
				["IDs"] = {
					"_TORSO_BUILDERS",
				}
			},
			{
				["TYPE"] = "_LEGS_",
				["IDs"] = {
					"_LEGS_BUILDERS",
				}
			},
		},
		["PART_WHITELISTS"] = {
			{
				["TYPE"] = "_HEAD_",
				["IDs"] = {
					"_HEAD_FOURTH",
					"_HEAD_ASTRO",
				}
			},
			{
				["TYPE"] = "_ASTRONECK_",
				["IDs"] = {
					"_ASTRONECK_XF",
				}
			},
			{
				["TYPE"] = "_FOURTHNECK_",
				["IDs"] = {
					"_FOURTHNECK_XF",
				}
			},
			{
				["TYPE"] = "_GEKNECK_",
				["IDs"] = {
					"_GEKNECK_XF",
				}
			},
			{
				["TYPE"] = "_ROBOT1NECK_",
				["IDs"] = {
					"_ROBOT1NECK_XF",
				}
			},
			{
				["TYPE"] = "_VANILLANECK_",
				["IDs"] = {
					"_VANILLANECK_XF",
				}
			},
			{
				["TYPE"] = "_VYKNECK_",
				["IDs"] = {
					"_VYKNECK_XF",
				}
			},
			{
				["TYPE"] = "_BACKPACK_",
				["IDs"] = {}
			},
			--[[{
				["TYPE"] = "_CAPE_",
				["IDs"] = {}
			},]]
		}
	},
}

MBIN_CHANGE_TABLE = {}

for _, NPC in ipairs(SETTINGS) do	
	
	COMPONENTS = {
		"GcClothComponentData",
		"GcSpringComponentData",
	}
	for _, component in ipairs(COMPONENTS) do
		MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
			["MBIN_FILE_SOURCE"] = {"MODELS/COMMON/PLAYER/PLAYERCHARACTER/PLAYERCHARACTER/ENTITIES/PLAYERCHARACTER.ENTITY.MBIN"},
			["MXML_CHANGE_TABLE"] = {
				{
					["SPECIAL_KEY_WORDS"] = {"Components", component},
					["SEC_COPY"] = component
				}
			}
		}
		
		MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
			["MBIN_FILE_SOURCE"] = {NPC["ENTITY"]},
			["MXML_CHANGE_TABLE"] = {
				{
					["PRECEDING_KEY_WORDS"] = {"Components"},
					["SEC_ADD_NAMED"] = component
				}
			}
		}
	end
	for _, node in ipairs(NPC["ATTACHMENTS"]) do
		MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
			["MBIN_FILE_SOURCE"] = {NPC["SCENE"]},
			["MXML_CHANGE_TABLE"] = {
				{
					["SPECIAL_KEY_WORDS"] = {"Name",node},
					["SEC_COPY"] = node
				}
			}
		}
	end
	
	MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
		["MBIN_FILE_SOURCE"] = {
			{"MODELS/COMMON/PLAYER/PLAYERCHARACTER/PLAYERCHARACTER.SCENE.MBIN",NPC["SCENE"]}
		},
	}
	
	MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
		["MBIN_FILE_SOURCE"] = {NPC["SCENE"]},
		["MXML_CHANGE_TABLE"] = {
			{
				["SPECIAL_KEY_WORDS"] = {"Name", "PlayerCharacterData"},
				["REMOVE"] = "SECTION"
			},
		}
	}
	
	--Make "_Backpack_Cape" a child of all capes (they look weird without it)
	MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
		["MBIN_FILE_SOURCE"] = {NPC["SCENE"]},
		["MXML_CHANGE_TABLE"] = {
			{
				["SPECIAL_KEY_WORDS"] = {"Name", "_Backpack_Cape"},
				["PRECEDING_KEY_WORDS"] = {"Children"},
				["SEC_COPY"] = "minimal_backpack"
			},
			{
				["SEC_EDIT"] = "minimal_backpack",
				["REMOVE"] = "HBOS",
			},
			{
				["SPECIAL_KEY_WORDS"] = {"Name", "_Cape_GRP", "Children", "TkSceneNodeData"},
				["PRECEDING_KEY_WORDS"] = {"Children"},
				["CREATE_HOS"] = "TRUE",
				["REPLACE_TYPE"] = "ALL",
				["SEC_ADD_NAMED"] = "minimal_backpack",
			}
		}
	}
	
	descriptor = NPC["SCENE"]:gsub(".SCENE.",".DESCRIPTOR.")
	anim = NPC["SCENE"]:gsub(".SCENE.",".ANIM.")
	MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
		["MBIN_FILE_SOURCE"] = {
			{"MODELS/COMMON/PLAYER/PLAYERCHARACTER/PLAYERCHARACTER.DESCRIPTOR.MBIN",descriptor},
			{"MODELS/COMMON/PLAYER/PLAYERCHARACTER/PLAYERCHARACTER.ANIM.MBIN",anim},
		}
	}
	
	for _, node in ipairs(NPC["ATTACHMENTS"]) do
		MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
			["MBIN_FILE_SOURCE"] = {NPC["SCENE"]},
			["MXML_CHANGE_TABLE"] = {
				{
					["PRECEDING_KEY_WORDS"] = {"Children"},
					["SEC_ADD_NAMED"] = node
				}
			}
		}
	end
	
	for _, PART in ipairs(NPC["PART_WHITELISTS"]) do
		for _, ID in ipairs(PART["IDs"]) do
			MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
				["MBIN_FILE_SOURCE"] = descriptor,
				["MXML_CHANGE_TABLE"] = {
					{
						["SPECIAL_KEY_WORDS"] = {"TypeId",PART["TYPE"],"Id",ID},
						["SEC_COPY"] = ID
					}
				}
			}
		end
		
		MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
			["MBIN_FILE_SOURCE"] = descriptor,
			["MXML_CHANGE_TABLE"] = {
				{
					["SPECIAL_KEY_WORDS"] = {"TypeId",PART["TYPE"],"Descriptors","TkResourceDescriptorData"},
					["REPLACE_TYPE"] = "ALL",
					["REMOVE"] = "SECTION"
				}
			}
		}
		
		for _, ID in ipairs(PART["IDs"]) do
			MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
				["MBIN_FILE_SOURCE"] = descriptor,
				["MXML_CHANGE_TABLE"] = {
					{
						["SPECIAL_KEY_WORDS"] = {"TypeId",PART["TYPE"]},
						["PRECEDING_KEY_WORDS"] = {"Descriptors"},
						["SEC_ADD_NAMED"] = ID
					}
				}
			}
		end
	end
	
	for _, PART in ipairs(NPC["PART_BLACKLISTS"]) do
		for _, ID in ipairs(PART["IDs"]) do
			MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
				["MBIN_FILE_SOURCE"] = descriptor,
				["MXML_CHANGE_TABLE"] = {
					{
						["SPECIAL_KEY_WORDS"] = {"TypeId",PART["TYPE"],"Id",ID},
						["REMOVE"] = "SECTION"
					}
				}
			}
		end
	end
	
	for _, PART in ipairs(NPC["PREFERRED_PARTS"]) do
		for _, ID in ipairs(PART["IDs"]) do
			MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
				["MBIN_FILE_SOURCE"] = descriptor,
				["MXML_CHANGE_TABLE"] = {
					{
						["SPECIAL_KEY_WORDS"] = {"TypeId",PART["TYPE"],"Id",ID},
						["SEC_COPY"] = ID
					}
				}
			}
			for _ = 1, PART["EXTRA_WEIGHT"] do
				MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
					["MBIN_FILE_SOURCE"] = descriptor,
					["MXML_CHANGE_TABLE"] = {
						{
							["SPECIAL_KEY_WORDS"] = {"TypeId",PART["TYPE"]},
							["PRECEDING_KEY_WORDS"] = {"Descriptors"},
							["SEC_ADD_NAMED"] = ID
						}
					}
				}
			end
		end
	end
	
	if BAN_NON_PLAYERCHARACTER_REF_PATHS then
		MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
			["MBIN_FILE_SOURCE"] = descriptor,
			["MXML_CHANGE_TABLE"] = {
				{--Label for deletion
					["REPLACE_TYPE"] = "ALL",
					["SPECIAL_KEY_WORDS"] = {"Descriptors", "TkResourceDescriptorData"},
					["PRECEDING_KEY_WORDS"] = {"ReferencePaths"},
					["VALUE_MATCH"] = "MODELS/COMMON/PLAYER/PLAYERCHARACTER/PLAYERCHARACTER.SCENE.MBIN",
					["VALUE_MATCH_OPTIONS"] = "~=",
					["VALUE_CHANGE_TABLE"] = {
						{"ReferencePaths", "delete_me_pls"}
					}
				},
				{--Delete
					["SPECIAL_KEY_WORDS"] = {"ReferencePaths", "delete_me_pls"},
					["SECTION_UP"] = 1,
					["REPLACE_TYPE"] = "ALL",
					["REMOVE"] = "SECTION",
				}
			}
		}
		
	end
	
	MBIN_CHANGE_TABLE[#MBIN_CHANGE_TABLE+1] = {
		["MBIN_FILE_SOURCE"] = descriptor,
		["MXML_CHANGE_TABLE"] = {
			{
				["SPECIAL_KEY_WORDS"] = {"Descriptors", "TkResourceDescriptorData"},
				["PRECEDING_KEY_WORDS"] = {"ReferencePaths"},
				["REPLACE_TYPE"] = "ALL",
				["CREATE_HOS"] = "TRUE",
				["ADD"] =
[[
<Property name="ReferencePaths" value="MODELS/COMMON/PLAYER/PLAYERCHARACTER/PLAYERCHARACTER.SCENE.MBIN" />
]]
			}
		}
	}
end

NMS_MOD_DEFINITION_CONTAINER = 
{
  ["MOD_FILENAME"] 			= "NPC Outfit Variety.pak",
  ["MOD_DESCRIPTION"]		= "NPCs now have more outfit variety, sometimes spawning with capes or with customization options from other factions.",
  ["MOD_AUTHOR"]				= "CodenameAwesome",
  ["MODIFICATIONS"] 		=
	{
		{
			["MBIN_CHANGE_TABLE"] = MBIN_CHANGE_TABLE
		},
	}
}